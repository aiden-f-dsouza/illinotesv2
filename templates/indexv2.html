<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Class Notes - UIUC Turbolearn</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- ===== MAJOR CHANGE #1: External CSS System ===== -->
  <!-- BEFORE: All styles were inline in a <style> tag with hardcoded colors -->
  <!-- NOW: Uses turbolearn-darkmode.css with CSS custom properties for light/dark mode support -->
  <link rel="stylesheet" href="{{ url_for('static', filename='turbolearn-darkmode.css') }}">
  
  <!-- ===== MAJOR CHANGE #2: Typography System ===== -->
  <!-- BEFORE: Used generic system fonts -->
  <!-- NOW: Uses Google Fonts (Merriweather for headings, Inter for body text) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Phosphor Icons -->
  <script src="https://unpkg.com/@phosphor-icons/web"></script>

  <!-- Choices.js for searchable dropdowns -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css">
  <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

  <!-- Notes page specific CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='notes-page.css') }}">
</head>
<body>
  <!-- Hidden data for JavaScript -->
  <div id="page-data"
       style="display: none;"
       data-page="{{ page|default(1) }}"
       data-classes='{{ classes | tojson }}'
       data-selected-filter="{{ selected_filter or 'All' }}">
  </div>

  <!-- Header with theme toggle and search -->
  <header class="tl-header">
    <div class="tl-container">
      <nav class="tl-nav">
        <a href="{{ url_for('home') }}" class="tl-logo">
          <div class="tl-logo-mark">TL</div>
          <div class="tl-logo-text">
            <span class="tl-logo-main">UIUC Turbolearn</span>
            <span class="tl-logo-sub">Class Notes</span>
          </div>
        </a>

        <div class="tl-nav-actions">
          <!-- Search bar in header -->
          <form method="get" action="/notes-feed" class="header-search-form">
            <input
              type="text"
              name="search"
              class="header-search-input"
              placeholder="Search notes..."
              value="{{ search_query or '' }}"
            >
          </form>

          <!-- Note Summarizer link -->
          <a href="/summarizer" style="color: var(--tl-text-primary); text-decoration: none; padding: 8px 16px; margin: 0 8px; white-space: nowrap;">Note Summarizer</a>

          <!-- Theme toggle -->
          <button class="theme-toggle" aria-label="Toggle dark mode">
            <span class="moon-icon"><i class="ph ph-moon"></i></span>
            <span class="sun-icon"><i class="ph ph-sun"></i></span>
          </button>
        </div>

        
      </nav>
    </div>
  </header>

  <!-- ===== Main Content (Functionality Unchanged) ===== -->
  <!-- All functionality below is the same as index.html, just with updated styling -->
  <div class="notes-page">
    <div class="tl-container">
      <div class="notes-title"><i class="ph-duotone ph-hand-waving" style="color: var(--accent-terracotta);"></i> Welcome to UIUC Turbolearn!</div>

      <!-- Share Your Notes Section -->
      <div class="section-card">
        <div class="section-header-row">
          <h2 class="section-heading"><i class="ph ph-note-pencil"></i> Share Your Notes</h2>
          <button class="btn btn-accent" onclick="openModal()">Add Note +</button>
        </div>
      </div>

      <!-- Find Your Course Section -->
      <div class="section-card">
        <h2 class="section-heading"><i class="ph ph-magnifying-glass"></i> Find Your Course</h2>
        <form method="get" action="/notes-feed" id="course-filter-form">
          <!-- Hidden fields to preserve other filters -->
          <input type="hidden" name="search" value="{{ search_query or '' }}">
          <input type="hidden" name="author_filter" value="{{ author_filter or 'All' }}">
          <input type="hidden" name="date_filter" value="{{ date_filter or 'All' }}">
          <input type="hidden" name="sort_by" value="{{ sort_by or 'recent' }}">
          
          <div style="display: flex; gap: 16px; margin-top: 16px;">
            <!-- Subject Dropdown -->
            <select id="subject-select" name="subject" class="course-select">
              <option value="">All Subjects</option>
            </select>
            
            <!-- Number Dropdown -->
            <select id="number-select" name="number" class="course-select">
              <option value="">All Numbers</option>
            </select>
            
            <!-- Hidden field to store combined class value for backend -->
            <input type="hidden" name="class_filter" id="class-filter-hidden" value="{{ selected_filter or 'All' }}">
          </div>
        </form>
      </div>

      <!-- Posted Notes Section -->
      <div class="section-card">
        <div class="section-header-row">
          <h2 class="section-heading"><i class="ph ph-notebook"></i> Posted Notes</h2>
          
          <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
            <!-- Note count -->
            <div class="note-count">{{ total }} notes</div>
            
            <!-- Date filter dropdown -->
            <form method="get" action="/notes-feed" style="margin: 0;">
              <!-- Preserve current filters -->
              <input type="hidden" name="search" value="{{ search_query or '' }}">
              <input type="hidden" name="class_filter" value="{{ selected_filter or 'All' }}">
              <input type="hidden" name="author_filter" value="{{ author_filter or 'All' }}">
              <input type="hidden" name="sort_by" value="{{ sort_by or 'recent' }}">
              
              <select name="date_filter" onchange="this.form.submit()">
                <option value="All" {% if date_filter == "All" %}selected{% endif %}>All Time</option>
                <option value="Today" {% if date_filter == "Today" %}selected{% endif %}>Today</option>
                <option value="Week" {% if date_filter == "Week" %}selected{% endif %}>This Week</option>
                <option value="Month" {% if date_filter == "Month" %}selected{% endif %}>This Month</option>
              </select>
            </form>
            
            <!-- Sort dropdown -->
            <form method="get" action="/notes-feed" style="margin: 0;">
              <!-- Preserve current filters -->
              <input type="hidden" name="search" value="{{ search_query or '' }}">
              <input type="hidden" name="class_filter" value="{{ selected_filter or 'All' }}">
              <input type="hidden" name="author_filter" value="{{ author_filter or 'All' }}">
              <input type="hidden" name="date_filter" value="{{ date_filter or 'All' }}">
              
              <select name="sort_by" onchange="this.form.submit()">
                <option value="recent" {% if sort_by == "recent" %}selected{% endif %}>Most Recent</option>
                <option value="oldest" {% if sort_by == "oldest" %}selected{% endif %}>Oldest First</option>
                <option value="title" {% if sort_by == "title" %}selected{% endif %}>Title (A-Z)</option>
                <option value="author" {% if sort_by == "author" %}selected{% endif %}>Author (A-Z)</option>
              </select>
            </form>
          </div>
        </div>
      </div>
   
      <!-- Notes Feed -->
      <div id="notes-container">
      {% for n in notes %}
      <div class="card">
        <!-- Note content -->
        <div id="note-content-{{ n.id }}" class="note-content">
          <div class="note-title">{{ n.title }}</div>
          <div class="note-meta">
            <span class="meta-tag"><i class="ph ph-user"></i> {{ n.author }}</span>
            <span class="meta-tag"><i class="ph ph-calendar"></i> {{ n.created }}</span>
            <span class="meta-tag"><i class="ph ph-book-open"></i> {{ n.class }}</span>
          </div>
          <div class="note-body">{{ n.body }}</div>
        </div>

        <!-- Edit form -->
        <div id="edit-form-{{ n.id }}" class="edit-form">
          <form method="POST" action="/edit/{{ n.id }}">
            <div style="margin-bottom: 12px;">
              <input type="text" name="title" value="{{ n.title }}" placeholder="Note title" required>
            </div>
            <div style="margin-bottom: 12px;">
              <input type="text" name="author" value="{{ n.author }}" placeholder="Author name">
            </div>
            <div style="margin-bottom: 12px;">
              <select name="class">
                {% for c in classes %}
                <option value="{{ c }}" {% if c == n.class %}selected{% endif %}>{{ c }}</option>
                {% endfor %}
              </select>
            </div>
            <div style="margin-bottom: 12px;">
              <textarea name="body" placeholder="Note content" required>{{ n.body }}</textarea>
            </div>
            <div style="display: flex; gap: 10px;">
              <button type="submit" class="btn-small btn-edit"><i class="ph ph-floppy-disk"></i> Save Changes</button>
              <button type="button" class="btn-small btn-cancel" onclick="toggleEdit('{{ n.id }}')"><i class="ph ph-x"></i> Cancel</button>
            </div>
          </form>
        </div>

        <!-- Action buttons -->
        <div class="note-actions">
          <button class="btn-small btn-edit" onclick="toggleEdit('{{ n.id }}')"><i class="ph ph-pencil"></i> Edit</button>
          <form method="POST" action="/delete/{{ n.id }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this note?');">
            <button type="submit" class="btn-small btn-delete"><i class="ph ph-trash"></i> Delete</button>
          </form>
        </div>
      </div>
      {% endfor %}
      </div>

      <!-- Load More button -->
      {% if has_more %}
        <div class="load-more-container">
          <button id="load-more" class="btn-small btn-edit" onclick="loadMore()"><i class="ph ph-arrow-down"></i> Load More</button>
        </div>
      {% endif %}

      <!-- Empty state -->
      {% if notes|length == 0 %}
        <div class="empty-state">
          <div class="empty-state-icon"><i class="ph ph-tray"></i></div>
          <div>No notes found matching your filters.</div>
          <div style="font-size: 14px; margin-top: 8px;">Try adjusting your search or filters.</div>
        </div>
      {% endif %}

    </div>
  </div>

  <!-- JavaScript -->
  <script src="{{ url_for('static', filename='theme-toggle.js') }}"></script>
  <script src="{{ url_for('static', filename='notes-page.js') }}"></script>


<!-- ===== MODAL FOR CREATING NOTES ===== -->
  <div id="note-modal" class="modal-overlay">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header">
        <h2 class="modal-title"><i class="ph ph-pencil-simple-line"></i> Create New Note</h2>
        <button class="modal-close" onclick="closeModal()">&times;</button>
      </div>
      
      <!-- Modal Body with Form -->
      <div class="modal-body">
        <form method="POST" action="/notes-feed" id="create-note-form">
          <div class="two">
            <input type="text" name="author" placeholder="Your name (optional)">
            <input type="text" name="title" placeholder="Note title">
          </div>

          <div style="margin-top: 16px;">
            <select name="class">
              {% for c in classes %}
              <option value="{{ c }}">{{ c }}</option>
              {% endfor %}
            </select>
          </div>

          <div style="margin-top: 16px;">
            <textarea name="body" placeholder="Write your note..." required></textarea>
          </div>

          <div style="margin-top: 20px; display: flex; gap: 12px; justify-content: flex-end;">
            <button type="button" class="btn-small btn-cancel" onclick="closeModal()">Cancel</button>
            <button type="submit" class="btn-search"><i class="ph ph-note-pencil"></i> Post Note</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  

</body>
</html>